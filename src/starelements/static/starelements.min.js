let $=0;const m=n=>n.replace(/-([a-z])/g,(i,o)=>o.toUpperCase()),h=(n,i,o=l=>l)=>{const l={};for(const c of n.attributes)c.name.startsWith(i)&&(l[c.name.slice(i.length)]=o(c.value));return l},_={string:n=>n,int:n=>parseInt(n,10),float:n=>parseFloat(n),boolean:n=>n==="true"||n===""||n===!0,json:n=>JSON.parse(n)};function C(n){let i="string",o=null;for(const c of n.split("|"))c in _?i=c:c.startsWith("=")&&(o=c.slice(1));const l=_[i];return{type:i,parse:l,default:o!==null?l(o):null}}export function initStarElements(){for(const n of document.querySelectorAll("template")){const i=Array.from(n.attributes).find(o=>o.name.startsWith("data-star:"));i&&v(i.name.replace("data-star:",""),n)}}function v(n,i){const o=h(i,"data-signal:",C),l=h(i,"data-import:"),c=h(i,"data-script:"),g=i.hasAttribute("data-shadow-open")||i.hasAttribute("data-shadow-closed"),b=i.hasAttribute("data-shadow-closed")?"closed":"open",S=i.content.querySelector("script:not([data-static])")?.textContent??"",p=i.content.querySelector("script[data-static]");if(p)try{new Function(p.textContent)()}catch(f){console.error(`[starelements] Static script error in ${n}:`,f)}class w extends HTMLElement{static observedAttributes=Object.keys(o);constructor(){super();const e=this.getAttribute("data-star-id");this._namespace=e||`_star_${n.replace(/-/g,"_")}_id${$++}`,this._hydrating=!!e,this._cleanups=[],this._imports={},this._connected=!1}_namespaceSignalRefs(e){return e.replace(/\$([a-z_][a-z0-9_]*)/gi,(t,s)=>`$${this._namespace}_${s}`)}async connectedCallback(){if(await this._loadImports(),this._signalValues=this._buildSignalValues(),!this._hydrating){const e=i.content.cloneNode(!0);for(const t of e.querySelectorAll("script"))t.remove();this._rewriteSignals(e),this._prepopulateText(e),g?this.attachShadow({mode:b}).appendChild(e):this.appendChild(e)}this._initSignals(),this._runSetup(S),this._triggerDatastarScan(),this._connected=!0,this.style.visibility="",this.setAttribute("data-star-ready","")}disconnectedCallback(){for(const e of this._cleanups)try{e()}catch(t){console.error(t)}this._cleanups=[],this._removeSignals()}attributeChangedCallback(e,t,s){if(t===s||!this._connected)return;const a=o[e],r=`${this._namespace}_${m(e)}`;window.__datastar_mergePatch?.({[r]:a?a.parse(s):s})}async _loadImports(){for(const[t,s]of Object.entries(l)){if(!window[t])try{const a=await import(s);window[t]=a.default||a}catch(a){console.error(`[starelements] Failed to load ${t} from ${s}:`,a)}this._imports[t]=window[t]}const e=t=>{const s=t.charAt(0).toUpperCase()+t.slice(1);return window[t]||window[s]||window[t.toUpperCase()]};for(const[t,s]of Object.entries(c))e(t)||await new Promise((a,r)=>{const d=document.createElement("script");d.src=s,d.onload=()=>a(),d.onerror=()=>r(new Error(`Failed to load ${t} from ${s}`)),document.head.appendChild(d)}).catch(a=>console.error(`[starelements] ${a.message}`)),this._imports[t]=e(t)}_rewriteSignals(e){const t=s=>{if(s.attributes){const a=[];for(const r of s.attributes)if(r.name==="data-ref"&&r.value)r.value=`${this._namespace}_${r.value}`;else if(r.name.startsWith("data-computed:")){const d=r.name.slice(14),u=`data-computed:${this._namespace}_${d}`,y=this._namespaceSignalRefs(r.value);a.push([r.name,u,y])}else r.value.includes("$")&&(r.value=this._namespaceSignalRefs(r.value));for(const[r,d,u]of a)s.removeAttribute(r),s.setAttribute(d,u)}s.childNodes?.forEach(t)};t(e)}_buildSignalValues(){const e={};for(const[t,s]of Object.entries(o)){const a=this.getAttribute(t);e[m(t)]=a!==null?s.parse(a):s.default}return e}_prepopulateText(e){const t=this._namespace+"_";for(const s of e.querySelectorAll("[data-text]")){const a=s.getAttribute("data-text").match(/\$([a-z_][a-z0-9_]*)/i);if(a?.[1]?.startsWith(t)){const r=a[1].slice(t.length);r in this._signalValues&&(s.textContent=String(this._signalValues[r]))}}}_initSignals(){const e=Object.fromEntries(Object.entries(this._signalValues).map(([t,s])=>[`${this._namespace}_${t}`,s]));this.setAttribute("data-signals",JSON.stringify(e))}_removeSignals(){const e=document.createElement("div");e.setAttribute("data-signals",JSON.stringify({[this._namespace]:null})),e.style.display="none",document.body.appendChild(e),setTimeout(()=>e.remove(),0)}_runSetup(e){if(!e.trim())return;const t={},s=a=>this.querySelector(`[data-ref="${this._namespace}_${a}"]`);try{new Function("el","onCleanup","actions","refs",...Object.keys(this._imports),this._namespaceSignalRefs(e))(this,a=>this._cleanups.push(a),t,s,...Object.values(this._imports)),this._actions=t}catch(a){console.error(`[starelements] Setup error in ${n}:`,a)}}_triggerDatastarScan(){this.dispatchEvent(new CustomEvent("datastar:scan",{bubbles:!0,detail:{root:this}}))}emit(e,t){this.dispatchEvent(new CustomEvent(e,{detail:t,bubbles:!0,cancelable:!0,composed:!1}))}}customElements.define(n,w)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",initStarElements):initStarElements();
